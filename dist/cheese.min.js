/*! cheese.js - v1.0.0 - 2014-01-14
* http://lukejones.com/
* Copyright (c) 2014 Luke Jones; Licensed MIT */
var app=app||{},helper=helper||{};app.router=app.router||{},app.router.Router=Backbone.Router.extend({view:null,routes:{"":"home",inventory:"inventory",sources:"sources",source:"source","source/:id":"source",arrivals:"arrivals",batch:"batch",createBatch:"createBatch",viewBatches:"viewBatches","*path":"home"},home:function(){this.view&&this.destroyView(),this.view=new app.view.Home},inventory:function(){this.view&&this.destroyView(),this.view=new app.view.Inventory},sources:function(){this.view&&this.destroyView(),this.view=new app.view.Sources},source:function(a){this.view&&this.destroyView();var b="Source";a?(this.view=new app.view.Source({id:a}),b="Edit "+b):(this.view=new app.view.Source,b="Add "+b)},arrivals:function(){this.view&&this.destroyView(),this.view=new app.view.Arrivals},batch:function(){this.view&&this.destroyView(),this.view=new app.view.Batch},createBatch:function(){new app.view.CreateBatch},viewBatches:function(){new app.BatchListingView},destroyView:function(){this.view.undelegateEvents(),$(this.view.el).removeData().unbind(),this.view.$el.children().remove(),this.view=null}}),app.model=app.model||{},app.model.Arrival=Backbone.Model.extend({idAttribute:"arrival_id",initialize:function(a){return"undefined"!=typeof a&&"object"!=typeof a?(this.urlRoot="/api/arrivals/"+a,this.fetch()):void 0}}),app.model=app.model||{},app.model.Batch=Backbone.Model.extend({defaults:{notes:"",milks:{}},idAttribute:"result",url:"/api/batches",initialize:function(a){return"undefined"!=typeof a&&"object"!=typeof a?(this.urlRoot="/api/batches/"+a,this.fetch()):void 0}}),app.model=app.model||{},app.model.Cheese=Backbone.Model.extend({defaults:{name:"cheese name",type_id:0,rennents:{},cultures:{},larges:0,mediums:0,smalls:0,batch_id:0},url:"/api/cheeses",initialize:function(a){return"undefined"!=typeof a?(this.urlRoot="/api/cheese/"+a,this.fetch()):void 0}}),app.model=app.model||{},app.model.CheeseType=Backbone.Model.extend({defaults:{name:"cheese name",description:""},idAttribute:"result"}),app.model=app.model||{},app.model.Culture=Backbone.Model.extend({defaults:{name:"culture name",description:""}}),app.model=app.model||{},app.model.Milk=Backbone.Model.extend({idAttribute:"milk_id",initialize:function(a){return"undefined"!=typeof a&&"object"!=typeof a?(this.urlRoot="/api/milks/"+a,this.fetch()):void 0}}),app.model=app.model||{},app.model.Rennent=Backbone.Model.extend({defaults:{name:"rennent name",description:""}}),app.model=app.model||{},app.model.Source=Backbone.Model.extend({defaults:{},idAttribute:"source_id",initialize:function(a){return"undefined"!=typeof a&&"object"!=typeof a?(this.urlRoot="/api/sources/"+a,this.fetch()):void 0}}),app.collection=app.collection||{},app.collection.Arrivals=Backbone.Collection.extend({model:app.model.Arrival,url:"/api/arrivals",parse:function(a){if(a.hasOwnProperty("success")){if(a.success)return a.result;console.log("error with fetch arrivals collection")}else if(a.hasOwnProperty("attributes")){if(a.attributes.success)return a.attributes.result;console.log("error with fetch arrivals collection")}}}),app.collection=app.collection||{},app.collection.Batches=Backbone.Collection.extend({model:app.model.Batch,url:"/api/batches",parse:function(a){return a.success?a.result:(console.log("error with fetch Batches collection"),void 0)}}),app.collection=app.collection||{},app.collection.CheeseTypes=Backbone.Collection.extend({model:app.model.CheeseType,url:"/api/cheeseTypes",parse:function(a){return a.success?a.result:(console.log("error with fetch CheeseTypes collection"),void 0)}}),app.collection=app.collection||{},app.collection.Cheeses=Backbone.Collection.extend({model:app.model.Cheese,url:"/api/cheeses",parse:function(a){return a.success?a.result:(console.log("error with fetch Cheeses collection"),void 0)}}),app.collection=app.collection||{},app.collection.Cultures=Backbone.Collection.extend({model:app.model.Culture,url:"/api/cultures",parse:function(a){return a.success?a.result:(console.log("error with fetch Cultures collection"),void 0)}}),app.collection=app.collection||{},app.collection.Milks=Backbone.Collection.extend({model:app.model.Milk,url:"/api/milks",parse:function(a){return a.success?a.result:(console.log("error with fetch Sources collection"),void 0)}}),app.collection=app.collection||{},app.collection.Rennents=Backbone.Collection.extend({model:app.model.Rennent,url:"/api/rennents",parse:function(a){return a.success?a.result:(console.log("error with fetch Rennents collection"),void 0)}}),app.collection=app.collection||{},app.collection.Sources=Backbone.Collection.extend({model:app.model.Source,url:"/api/sources",parse:function(a){if(a.hasOwnProperty("success")){if(a.success)return a.result;console.log("error with fetch sources collection")}else if(a.hasOwnProperty("attributes")){if(a.attributes.success)return a.attributes.result;console.log("error with fetch sources collection")}}}),app.view=app.view||{},app.view.Arrivals=Backbone.View.extend({template:"arrivals",milk_tmpl:"milk",el:$("#wrapper"),events:{"click #milk":"milk","click table.display tr":"edit"},initialize:function(){app.arrivals?this.render():(app.arrivals=new app.collection.Arrivals,app.arrivals.fetch({reset:!0}),this.listenToOnce(app.arrivals,"reset",this.render))},render:function(){var a=this,b=[],c=[];app.arrivals.each(function(a,d){var e=[];$.each(a.attributes,function(a,c){if("source_id"!=a&&"haccp"!=a&&"notes"!=a&&"created"!=a)if(0==d&&b.push({sTitle:a}),"arrival"==a||"updated"==a){var f=new Date(c);e.push(app.formatDate(f))}else if("type"==a)switch(c){case 1:e.push("milk")}else e.push(c)}),c.push(e)}),app.getTemplate(this.template,{}).done(function(d){$(a.el).html(d),$("#table_wrapper").dataTable({bJQueryUI:!0,sPaginationType:"full_numbers",aaData:c,aoColumns:b}),$(document).tooltip(),$("button").button(),a.$el.addClass("notable")})},milk:function(a,b){a.preventDefault();var c=$(a.currentTarget);if(!c.hasClass("disabled")){var d={};d.append=!1,b&&(d.id=b),new app.view.Milk(d),c.addClass("disabled")}},edit:function(a){a.preventDefault();var b=parseInt($(a.currentTarget).find("td").eq(0).html()),c=$(a.currentTarget).find("td").eq(1).html();switch(c){case"milk":this.milk(a,b),app.router.inst.navigate("milk",{trigger:!1,replace:!0})}}}),app.view=app.view||{},app.view.Batch=Backbone.View.extend({template:"batch",row_tmpl:"source_row",el:$("#wrapper"),$current:null,count:0,names:[],lookup:{},events:{"click #add_cheese":"add","click #save_batch":"save","click .plus":"plus"},initialize:function(){app.milks.fetch({reset:!0}),this.listenToOnce(app.milks,"reset",this.render)},render:function(){var a=this;app.getTemplate(this.template,{idx:this.count}).done(function(b){a.count+=1,$(a.el).html(b),$("button").button(),$("#date").datetimepicker(),app.milks.each(function(b){_.contains(a.names,b.attributes.name)||(a.names.push(b.attributes.name),a.lookup[b.attributes.name]=parseInt(b.attributes.amount))}),a.auto(),a.$el.addClass("notable")})},add:function(a){a.preventDefault();new app.view.Cheese},plus:function(a){a.preventDefault();var b=this;app.getTemplate(this.row_tmpl,{idx:this.count}).done(function(a){b.count+=1,$("#bottom").before(a),b.auto()})},auto:function(){var a=this;$(".source").not(".ui-autocomplete-input").autocomplete({source:a.names,change:function(b,c){var d=$(this).attr("id").split("-").pop();$(this).val()?($("#volumes-"+d).val(a.lookup[c.item.value]),$("#volumes-"+d).data("max",a.lookup[c.item.value])):$("#volumes-"+d).val("")}})}}),app.BatchListingView=Backbone.View.extend({template:"batchListing",el:$("#wrapper"),events:{"click table.display tr":"rowClicked"},initialize:function(){app.batches.fetch({reset:!0}),this.listenTo(app.batches,"reset",this.render)},render:function(){var a=this,b=[],c=[];app.batches.each(function(a,d){var e=[];$.each(a.attributes,function(a,c){0==d&&b.push({sTitle:a}),e.push(c)}),c.push(e)}),app.getTemplate(this.template,{}).done(function(d){$(a.el).html(d),$("#table_wrapper").dataTable({bJQueryUI:!0,sPaginationType:"full_numbers",aaData:c,aoColumns:b})})},rowClicked:function(a){console.log(parseInt($(a.currentTarget).find("td").eq(0).html()))},renderBatch:function(a){var b=new app.BatchVatView({model:a}),c=$(".batchWrapper");c.append(b.render().el)}}),app.view=app.view||{},app.view.CreateBatch=Backbone.View.extend({template:"createBatchTmpl",$volumeAddTmpl:$("#batchVolumeAddTemplate"),el:$("#wrapper"),sources:1,cheeses:[],milkNames:[],cheeseNames:[],typeNames:[],cheeseIdx:0,events:{"click #addCheese":"addCheese","click #addBatch":"saveBatch"},initialize:function(){this.cheeseCollection=new app.collection.Cheeses,this.render()},setupNames:function(){var a=this;this.names.each(function(b){a.cheeseNames.push(b.get("title"))})},setupTypes:function(){var a=this;this.types.each(function(b){a.typeNames.push(b.get("title"))})},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){$(a.el).html(b);var c=new Date,d="";d=app.getDate(c),$("#creation_date").attr("value",d);var e=new app.view.Milk;$.when(e.render()).then(function(){$(".batchInputs .sourcesDrop").menu(),e.setupMilks()})})},renderCheese:function(a){var b=new app.view.Cheese({model:a}),c=$(".batchWrapper"),d=b.render({cheeseIdx:this.cheeseIdx,types:this.typeNames,cheese:this.cheeseNames}).el;c.append(d),$("#large-"+this.cheeseIdx+", #medium-"+this.cheeseIdx+", #small-"+this.cheeseIdx).on("keyup",function(){var a,b=$(this).parent().parent().attr("data"),c=parseInt($("#large-"+b).val())||0,d=parseInt($("#medium-"+b).val())||0,e=parseInt($("#small-"+b).val())||0;a=c+d+e,$("#total-"+b).html(a)}),this.cheeseIdx+=1},addCheese:function(a){a.preventDefault();var b=new app.view.Cheese;$.when(b.render()).then(function(a){$(".batchWrapper").append(a),$(".cheeseDrop",a).menu(),$("#large, #medium, #small",a).on("keyup",function(){var b,c=parseInt($("#large",a).val())||0,d=parseInt($("#medium",a).val())||0,e=parseInt($("#small",a).val())||0;b=c+d+e,$("#total",a).html(b)}),b.setupCheeseTypes(),b.setupRennents(),b.setupCultures()})},saveBatch:function(){var a,b=this,c={};c.milks=[],$.each($(".autoSource"),function(a,b){c.milks.push({volume:$(".batchInputs").eq(a).find("input").eq(0).val(),milk_id:$(b).attr("data-idx")})}),c.notes=$("#notes").val(),a=app.batches.create(c,{success:function(){var c=a.id.batch_id;b.saveCheeses(c)}})},saveCheeses:function(a){var b=$(".batchWrapper").children(),c=this;$.each(b,function(b,d){var e={};e.name=$(d).find(".cheeseName").val(),e.type_id=$(d).find(".cheeseType").attr("data-idx"),e.rennents=[],$.each($(".cheeseRennent",$(d)),function(a,b){e.rennents.push($(b).attr("data-idx"))}),e.cultures=[],$.each($(".cheeseCulture",$(d)),function(a,b){e.cultures.push($(b).attr("data-idx"))}),e.largers=$(d).find("#large").val(),e.mediums=$(d).find("#medium").val(),e.smalls=$(d).find("#small").val(),e.batch_id=a,c.cheeseCollection.create(e)})}}),app.view=app.view||{},app.view.Cheese=Backbone.View.extend({template:"cheese",tagName:"li",options:{},model:null,events:{"change .cheeseSource":"change","keyup .cheeseSource":"change"},initialize:function(){this.max=parseInt($("#total").val()),this.render()},render:function(){var a=this,b=[];$.each($(".source"),function(a,c){var d={};d.idx=a,d.name=$(c).val(),b.push(d)}),app.getTemplate(this.template,{sources:b}).done(function(b){a.$el.html(b),$("#cheeseBlock").append(a.el)})},change:function(a){a.preventDefault();var b,c=$(a.currentTarget),d=0,e=parseInt(c.attr("id")),f=parseInt($("#volumes-"+e).data("max"));$.each($(".cheese"+e),function(a,b){d+=parseInt($(b).val())}),parseInt(d)>0?(b=f-d,0>b?console.log("Not enough milk"):$("#volumes-"+e).val(b)):console.log("Cannot have negative amount of milk")},clear:function(){},update:function(){},"delete":function(a){a.preventDefault(),confirm("Are you sure you want to delete this cheese?  This operation cannot be undone")&&this.model.destroy()}}),app.view=app.view||{},app.view.Culture=Backbone.View.extend({template:"culture",el:$("#wrapper"),options:{},events:{"click #save":"save","click #clear":"clear"},initialize:function(a){this.options=a||{},this.render()},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){a.options.append?$(a.el).append(b):$(a.el).html(b),$(document).tooltip(),$("button").button(),$("#date").datetimepicker()})},clear:function(a){a.preventDefault(),$("input").val(""),$("select").val("select"),$("textarea").val("")},save:function(a){a.preventDefault();var b={};b.source=$("#source").val(),b.date=$("#date").val(),b.temp=$("#temp").val(),b.amount=$("#amount").val(),b.notes=$("#notes").val()}}),app.view=app.view||{},app.view.Home=Backbone.View.extend({template:"home",el:$("#wrapper"),events:{"click #invMgmt":"inventory","click #btchMgmt":"batch"},initialize:function(){this.render(),$(".breadcrumbs-two").remove()},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){$(a.el).html(b),$("button").button(),a.$el.removeClass("notable")})},inventory:function(a){a.preventDefault(),app.router.inst.navigate("inventory",{trigger:!0})},batch:function(a){a.preventDefault(),app.router.inst.navigate("batch",{trigger:!0})}}),app.view=app.view||{},app.view.Inventory=Backbone.View.extend({template:"inventory",el:$("#wrapper"),events:{"click #sources":"sources","click #arrival":"arrival"},initialize:function(){this.render()},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){$(a.el).html(b),$(document).tooltip(),$("button").button()})},sources:function(a){a.preventDefault(),app.router.inst.navigate("sources",{trigger:!0})},arrival:function(a){a.preventDefault(),app.router.inst.navigate("arrival",{trigger:!0})}}),app.view=app.view||{},app.view.Menu=Backbone.View.extend({template:"menu",row:_.template('<li id="<%= id %>" class="current"><%= name %></li>'),label:_.template('<div class="label"><h1><%= name %></h1></div>'),el:$("header"),events:{"click #home":"home","click #invMgmt":"inventory","click #batch":"batch","click #sources":"sources","click #arrivals":"arrivals","click #milk":"milk"},initialize:function(){this.render()},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){$(a.el).html(b),$("button").button()})},context:function(a){$(".label").length&&$(".label").remove(),this.$el.append(this.label(a))},home:function(a){a.preventDefault(),$(".breadcrumbs-two").remove(),$(".label").remove(),app.router.inst.navigate("",{trigger:!0})},inventory:function(a){a.preventDefault();var b=this;app.getTemplate("inventory",{}).done(function(a){$(".breadcrumbs-two").length?$(".breadcrumbs-two").html(a):b.$el.append(a)}),$(".label").remove(),app.router.inst.navigate("",{trigger:!0,replace:!0})},batch:function(a){a.preventDefault(),$(".breadcrumbs-two").remove(),$(".label").remove(),app.router.inst.navigate("batch",{trigger:!0})},sources:function(a){a.preventDefault();$(a.currentTarget);app.router.inst.navigate("sources",{trigger:!0}),this.context({name:"Sources"})},arrivals:function(a){a.preventDefault();var b=this;app.getTemplate("arrivals_menu",{}).done(function(a){$(".breadcrumbs-two").length?$(".breadcrumbs-two").html(a):b.$el.append(a)}),app.router.inst.navigate("arrivals",{trigger:!0}),this.context({name:"Arrivals"})},milk:function(a){app.router.inst.view.milk(a),app.router.inst.navigate("milk",{trigger:!1,replace:!0}),this.context({name:"Milk"})}}),app.view=app.view||{},app.view.Milk=Backbone.View.extend({template:"milk",el:$("#wrapper"),success:_.template('<div><p><span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span><%= message %></p><div>'),options:{},model:null,events:{"click #save_milk":"save","click #update_milk":"update","click #delete_milk":"delete","click #clear_milk":"clear"},initialize:function(a){var b=this;this.options=a||{},async.parallel({milk:function(c){a.id?app.arrivals?(b.model=app.arrivals.get(a.id),c(null,b.model)):(app.arrivals=new app.collection.Arrivals,app.arrivals.fetch({reset:!0}),this.listenToOnce(app.arrivals,"reset",function(d){b.model=d.get(a.id),c(null,b.model)})):c(null,{attributes:{result:[]}})},sources:function(a){app.sources?a(null,app.sources):(app.sources=new app.collection.Sources,app.sources.fetch({reset:!0}),b.listenToOnce(app.sources,"reset",function(b){a(null,b)}))}},function(a,c){a?console.log(a):b.render(c)})},render:function(a){var b,c=this,d=[],e={};a.milk&&a.milk.attributes.arrival_id&&(b=a.milk.attributes,e.type=b.type,e.source=b.source_id,e.date=b.arrival,e.temp=b.temperature,e.amount=b.amount,e.raw=b.raw,e.price=b.price,e.haccp=b.haccp,e.initials=b.initials,e.notes=b.notes,e.updated=!0),a.sources.each(function(a){var b={};1==a.attributes.type&&(b.selected=e.source&&e.source==a.attributes.source_id?!0:!1,b.value=a.attributes.source_id,b.key=a.attributes.name,d.push(b))}),app.getTemplate(this.template,{objects:d,data:e}).done(function(a){c.options.append?$(c.el).append(a):$(c.el).html(a),$(document).tooltip(),$("button").button(),$("#date").datetimepicker()})},clear:function(a){a.preventDefault(),$("input").val(""),$("input:checkbox").prop("checked",!1),$("select").val("select"),$("textarea").val("")},save:function(a){a.preventDefault();var b,c=this,d={},e=!0,f=[];$.each($(".validate"),function(a,b){$(b).hasClass("invalid")?(e=!1,"source"==$(b).attr("id")?f.push("You must choose a source"):"haccp"==$(b).attr("id")?f.push("Please follow HACCP guidelines!"):f.push($("label[for='"+$(b).attr("name")+"']").html()+" has invalid input")):b.attributes.hasOwnProperty("required")&&!$(b).hasClass("valid")&&""==$(b).val()&&(e=!1,"source"==$(b).attr("id")?f.push("You must choose a source"):"haccp"==$(b).attr("id")?f.push("Please follow HACCP guidelines!"):f.push($("label[for='"+$(b).attr("name")+"']").html()+" requires input"))}),e?(d.type=1,d.source=$("#source").val(),d.date=$("#date").val(),d.temperature=$("#temp").val(),d.amount=$("#amount").val(),d.raw=$("#raw").val(),d.price=$("#price").val(),d.haccp=$("#haccp").is(":checked")?1:0,d.initials=$("#initials").val(),d.notes=$("#notes").val(),b=app.arrivals.create(d,{error:function(a){new app.view.Errors({errors:["Error saving the model: "+a]})},success:function(){$(c.success({message:"Milk arrival has successfully been added..."})).dialog({title:"Addition Successful!",modal:!0,width:470,show:{effect:"fold",duration:300},hide:{effect:"fold",duration:300},open:function(){var a=this;setTimeout(function(){$(a).dialog("close"),$(a).remove()},1500)},close:function(){app.router.inst.navigate("arrivals",{trigger:!0,replace:!0})}})},wait:!0})):new app.view.Errors({errors:f})},update:function(a){a.preventDefault();var b=this,c={},d=!0,e=[];$.each($(".validate"),function(a,b){$(b).hasClass("invalid")?(d=!1,"source"==$(b).attr("id")?e.push("You must choose a source"):"haccp"==$(b).attr("id")?e.push("Please follow HACCP guidelines!"):e.push($("label[for='"+$(b).attr("name")+"']").html()+" has invalid input")):b.attributes.hasOwnProperty("required")&&!$(b).hasClass("valid")&&""==$(b).val()&&(d=!1,"source"==$(b).attr("id")?e.push("You must choose a source"):"haccp"==$(b).attr("id")?e.push("Please follow HACCP guidelines!"):e.push($("label[for='"+$(b).attr("name")+"']").html()+" requires input"))}),d?(c.type=1,c.source=$("#source").val(),c.date=$("#date").val(),c.temperature=$("#temp").val(),c.amount=$("#amount").val(),c.raw=$("#raw").val(),c.price=$("#price").val(),c.haccp=$("#haccp").is(":checked")?1:0,c.initials=$("#initials").val(),c.notes=$("#notes").val(),this.model.save(c,{error:function(a){new app.view.Errors({errors:["Error updating the model: "+a]})},success:function(){$(b.success({message:"Milk arrival has successfully been updated..."})).dialog({title:"Update Successful!",modal:!0,width:470,show:{effect:"fold",duration:300},hide:{effect:"fold",duration:300},open:function(){var a=this;setTimeout(function(){$(a).dialog("close"),b.$success.remove()},1500)},close:function(){window.history.back()}})}})):new app.view.Errors({errors:e})},"delete":function(a){a.preventDefault(),confirm("Are you sure you want to delete this arrival?  This operation cannot be undone")&&this.model.destroy()}}),app.view=app.view||{},app.view.Rennent=Backbone.View.extend({template:"rennent",el:$("#wrapper"),options:{},events:{"click #save":"save","click #clear":"clear"},initialize:function(a){this.options=a||{},this.render()},render:function(){var a=this;app.getTemplate(this.template,{}).done(function(b){a.options.append?$(a.el).append(b):$(a.el).html(b),$(document).tooltip(),$("button").button(),$("#date").datetimepicker()})},clear:function(a){a.preventDefault(),$("input").val(""),$("select").val("select"),$("textarea").val("")},save:function(a){a.preventDefault();var b={};b.source=$("#source").val(),b.date=$("#date").val(),b.temp=$("#temp").val(),b.amount=$("#amount").val(),b.notes=$("#notes").val()}}),app.view=app.view||{},app.view.Source=Backbone.View.extend({template:"source",el:$("#wrapper"),success:_.template('<div><p><span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span><%= message %></p><div>'),options:{},source:null,model:null,events:{"click #clear":"clear","click #save":"save","click #delete":"delete","click #update":"update","keyup .autotab":"jump"},initialize:function(a){var b=this;this.options=a||{},this.options.id?app.sources?(this.model=app.sources.get(a.id),this.render(this.model)):(app.sources=new app.collection.Sources,app.sources.fetch({reset:!0}),this.listenToOnce(app.sources,"reset",function(c){b.model=c.get(a.id),b.render(b.model)})):this.render({attributes:{result:[]}})},render:function(a){var b=this,c=a.attributes;if(c.source_id){var d=c;switch(d.update=!0,d.type){case 1:d.milk=!0}10==d.phone.length?(d.pstart=d.phone.substring(0,3),d.pmid=d.phone.substring(3,6),d.pend=d.phone.substring(6,10)):d.phone=!1,b.display(d)}else this.display({})},display:function(a){var b=this;app.getTemplate(this.template,a).done(function(a){$(b.el).html(a),$(document).tooltip(),$("button").button()})},jump:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.attr("maxlength"),d=b.val().length;d>=c&&b.next().focus()},clear:function(a){a.preventDefault(),$("input").val(""),$("select").val("select"),$("textarea").val("")},save:function(a){a.preventDefault();var b,c=this,d={},e=!0,f=[];$.each($(".validate"),function(a,b){$(b).hasClass("invalid")?(e=!1,"source"==$(b).attr("id")?f.push("You must choose a source"):-1!==$(b).attr("id").indexOf("phone")?f.push("Invalid characters in the phone number"):f.push($("label[for='"+$(b).attr("name")+"']").html()+" has invalid input")):b.attributes.hasOwnProperty("required")&&!$(b).hasClass("valid")&&""==$(b).val()&&(e=!1,"source"==$(b).attr("id")?f.push("You must choose a source"):-1!==$(b).attr("id").indexOf("phone")?f.push("Phone number requires input"):f.push($("label[for='"+$(b).attr("name")+"']").html()+" requires input"))}),e?(d.name=$("#name").val(),d.fullname=$("#cname").val(),d.source=$("#source").val(),d.phone=$("#phone_start").val()+$("#phone_mid").val()+$("#phone_end").val(),d.email=$("#email").val(),d.address=$("#address").val(),d.notes=$("#notes").val(),b=app.sources.create(d,{error:function(a){new app.view.Errors({errors:["Error saving the model: "+a]})},success:function(){$(c.success({message:"Source has successfully been added..."})).dialog({title:"Addition Successful!",modal:!0,width:470,show:{effect:"fold",duration:300},hide:{effect:"fold",duration:300},open:function(){var a=this;setTimeout(function(){$(a).dialog("close"),$(a).remove()},1500)},close:function(){window.history.back()}})},wait:!0})):new app.view.Errors({errors:f})},update:function(a){a.preventDefault();var b=this,c={},d=!0,e=[];$.each($(".validate"),function(a,b){$(b).hasClass("invalid")?(d=!1,"source"==$(b).attr("id")?e.push("You must choose a source"):-1!==$(b).attr("id").indexOf("phone")?e.push("Invalid characters in the phone number"):e.push($("label[for='"+$(b).attr("name")+"']").html()+" has invalid input")):b.attributes.hasOwnProperty("required")&&!$(b).hasClass("valid")&&""==$(b).val()&&(d=!1,"source"==$(b).attr("id")?e.push("You must choose a source"):-1!==$(b).attr("id").indexOf("phone")?e.push("Phone number requires input"):e.push($("label[for='"+$(b).attr("name")+"']").html()+" requires input"))}),d?(c.name=$("#name").val(),c.fullname=$("#cname").val(),c.source=parseInt($("#source").val()),c.phone=$("#phone_start").val()+$("#phone_mid").val()+$("#phone_end").val(),c.email=$("#email").val(),c.address=$("#address").val(),c.notes=$("#notes").val(),this.model.save(c,{error:function(){new app.view.Errors({errors:["Error updating the model: "+errorMsg]})},success:function(){$(b.success({message:"Source has successfully been updated..."})).dialog({title:"Update Successful!",modal:!0,width:470,show:{effect:"fold",duration:300},hide:{effect:"fold",duration:300},open:function(){var a=this;setTimeout(function(){$(a).dialog("close"),b.$success.remove()},1500)},close:function(){window.history.back()}})}})):new app.view.Errors({errors:e})},"delete":function(a){a.preventDefault(),confirm("Are you sure you want to delete this source?  This operation cannot be undone")&&(this.model.destroy(),window.history.back())}}),app.view=app.view||{},app.view.Sources=Backbone.View.extend({template:"sources",el:$("#wrapper"),events:{"click #add":"add","click table.display tr":"edit"},initialize:function(){app.sources?this.render():(app.sources=new app.collection.Sources,app.sources.fetch({reset:!0}),this.listenToOnce(app.sources,"reset",this.render))},render:function(){var a=this,b=[],c=[];app.sources.each(function(a,d){var e=[];$.each(a.attributes,function(a,c){if("address"!=a&&"notes"!=a&&"created"!=a)if(0==d&&b.push({sTitle:a}),"type"==a)switch(parseInt(c)){case 1:e.push("milk")}else e.push(c)}),c.push(e)}),app.getTemplate(this.template,{}).done(function(d){$(a.el).html(d),$("#table_wrapper").dataTable({bJQueryUI:!0,sPaginationType:"full_numbers",aaData:c,aoColumns:b}),$("button").button(),a.$el.addClass("notable")})},add:function(a){a.preventDefault(),app.router.inst.navigate("source",{trigger:!0})},edit:function(a){a.preventDefault();var b=parseInt($(a.currentTarget).find("td").eq(0).html());app.router.inst.navigate("source/"+b,{trigger:!0})}}),app.view=app.view||{},app.view.CheeseNameModal=Backbone.View.extend({template:"createCheese",tagName:"div",className:"modal",events:{"click .saveModal":"save","click .cancelModal":"cancel"},initialize:function(){},render:function(){var a=this;return app.getTemplate(this.template,{}).then(function(b){return $(a.el).html(b)})},save:function(){},cancel:function(){this.$el.remove()}}),app.view=app.view||{},app.view.CheeseTypeModal=Backbone.View.extend({template:"createCheeseType",tagName:"div",className:"modal",events:{"click .saveModal":"save","click .cancelModal":"cancel"},initialize:function(){_.bindAll(this,"save","remove")},render:function(){var a=this;return app.getTemplate(this.template,{}).then(function(b){return $(a.el).html(b)})},save:function(){var a,b,c,d=this;a=$(".modalName input",this.$el).val(),b=$(".modalDescription textarea",this.$el).val(),c=app.cheeseTypes.create({name:a,description:b},{success:function(){d.$el.trigger("saved.type",{name:c.id.name})}}),_.delay(this.remove,1e3)},cancel:function(){this.$el.remove()}}),app.view=app.view||{},app.view.CultureModal=Backbone.View.extend({template:"createCulture",tagName:"div",className:"modal",events:{"click .saveModal":"save","click .cancelModal":"cancel"},initialize:function(){},render:function(){var a=this;return app.getTemplate(this.template,{}).then(function(b){return $(a.el).html(b)})},save:function(){var a,b;a=$(".modalName input",this.$el).val(),b=$(".modalDescription textarea",this.$el).val(),app.cultures.create({name:a,description:b}),_.delay(this.$el.remove,1e3)},cancel:function(){this.$el.remove()}}),app.view=app.view||{},app.view.MilkModal=Backbone.View.extend({template:"createMilk",tagName:"div",className:"modal",events:{"click .saveModal":"save","click .cancelModal":"cancel"},initialize:function(){_.bindAll(this,"save","remove")},render:function(){var a=this;return app.getTemplate(this.template,{}).then(function(b){return $(a.el).html(b)})},save:function(){var a,b,c,d=this;a=$(".modalName input",this.$el).val(),b=$(".modalDescription textarea",this.$el).val(),c=app.milks.create({name:a,description:b},{success:function(){d.$el.trigger("saved.milk",{name:c.id.name,milk_id:c.id.milk_id})}}),_.delay(this.remove,1e3)},cancel:function(){this.$el.remove()}}),app.view=app.view||{},app.view.RennentModal=Backbone.View.extend({template:"createRennent",tagName:"div",className:"modal",events:{"click .saveModal":"save","click .cancelModal":"cancel"},initialize:function(){},render:function(){var a=this;return app.getTemplate(this.template,{}).then(function(b){return $(a.el).html(b)})},save:function(){var a,b;a=$(".modalName input",this.$el).val(),b=$(".modalDescription textarea",this.$el).val(),app.rennents.create({name:a,description:b}),_.delay(this.$el.remove,1e3)},cancel:function(){this.$el.remove()}}),function(){Number.prototype.padLeft=function(a,b){var c=String(a||10).length-String(this).length+1;return c>0?new Array(c).join(b||"0")+this:this},app.getDate=function(a){return a=a.getUTCFullYear()+"-"+("00"+(a.getUTCMonth()+1)).slice(-2)+"-"+("00"+a.getUTCDate()).slice(-2)+" "+("00"+a.getUTCHours()).slice(-2)+":"+("00"+a.getUTCMinutes()).slice(-2)+":"+("00"+a.getUTCSeconds()).slice(-2)},app.formatDate=function(a){var b=[a.getDate().padLeft(),(a.getMonth()+1).padLeft(),a.getFullYear()].join("/")+" "+[a.getHours().padLeft(),a.getMinutes().padLeft()].join(":");return b},app.getTemplate=function(a,b){return $.get("js/app/templates/"+a+".hbs").then(function(a){return Handlebars.compile(a)(b)}).fail(function(a){console.log(a)})},app.sources=null,app.arrivals=null,app.milks=null,app.menu=new app.view.Menu,app.router.inst=new app.router.Router,Backbone.history.start()}(),app.view=app.view||{},app.view.Errors=Backbone.View.extend({template:"errors",tagName:"div",id:"errors",options:{},events:{},initialize:function(a){a.errors?this.render(a.errors):this.render({})},render:function(a){var b=this;app.getTemplate(this.template,{errors:a}).done(function(a){b.$el.html(a).prependTo("body"),b.$el.dialog({title:"Errors on Page",modal:!0,resizable:!0,width:470,show:{effect:"fold",duration:300},hide:{effect:"fold",duration:300},buttons:{Close:function(){$(this).dialog("close"),this.remove()}}})})}}),function(){helper.process=function(a){var b={},c=a.val();if($(a[0].attributes).each(function(){b[this.nodeName]=this.nodeValue}),b.hasOwnProperty("required")&&0==c.length)return!1;if(a.is("select")){if("select"===a.val())return!1}else{if(b.size&&c.length!=b.size)return!1;switch(b.type){case"email":var d=new RegExp("^[0-9a-zA-Z]+@[0-9a-zA-Z]+[.]{1}[0-9a-zA-Z]+[.]?[0-9a-zA-Z]+$");if(!d.test(c))return!1;break;case"number":case"phone":if(!$.isNumeric(c))return!1;break;case"checkbox":if(!a.is(":checked"))return!1;break;case"datetime":break;case"text":}}return!0},helper.listen=function(){$("body").on("focusout",".validate",function(){helper.process($(this))?($(this).removeClass("invalid"),$(this).addClass("valid")):($(this).removeClass("valid"),$(this).addClass("invalid"))}),$("body").on("click",".validate:checkbox",function(){helper.process($(this))?($(this).removeClass("invalid"),$(this).addClass("valid")):($(this).removeClass("valid"),$(this).addClass("invalid"))}),$("body").on("focusin",".validate",function(){$(this).removeClass("valid"),$(this).removeClass("invalid")})},helper.listen()}();